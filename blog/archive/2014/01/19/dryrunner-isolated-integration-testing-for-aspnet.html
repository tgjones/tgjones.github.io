<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">

    <title>DryRunner: Isolated integration testing for ASP.NET - timjones.io</title>

    <meta name="description" content="Blog and open source projects by Tim Jones.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="alternate" href="http://timjones.io/feed.xml" type="application/atom+xml" title="timjones.io Feed">

    <link href="https://fonts.googleapis.com/css?family=Noto+Sans|Noto+Serif|Source+Code+Pro" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/site.css">

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$','$'], ['\\(','\\)']],
                processEscapes: true
            },
            showProcessingMessages: false
        });
    </script>
    <script type="text/javascript" async src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML.js"></script>
</head>

<body>
    <header class="masthead">
        <div class="container">
            <nav>
                <ul>
                    <li>
                        <h3><a href="/" class="site-title">Tim Jones</a></h3>
                    </li>
                    <li><a href="/projects/">Projects</a></li>
                    <li><a href="/about/">About</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        <main>
            <article>
    <h1 class="post-title">DryRunner: Isolated integration testing for ASP.NET</h1>

    <div class="post-date">
        <time datetime="2014-01-19T19:45:00+00:00">19 January 2014</time>
    </div>

    

    <h3 id="tldr">TL/DR</h3>

<p>DryRunner is an open source library for .NET that enables isolated integration testing for ASP.NET websites.</p>

<ul>
  <li><a href="https://github.com/tgjones/dryrunner">Source code</a></li>
  <li><a href="https://www.nuget.org/packages/DryRunner/">NuGet package</a></li>
</ul>

<h3 id="the-problem">The problem</h3>

<p>ASP.NET might not have such a rich ecosystem of testing frameworks as, say, <a href="http://rubyonrails.org/">Ruby on Rails</a>, but the situation is improving. Tools like <a href="http://www.specflow.org/">SpecFlow</a>, a .NET port of Cucumber, make integration testing much easier than it used to be. I like SpecFlow a lot. It’s a great way to do end-to-end testing of an ASP.NET website. Combined with a browser automation tool like <a href="http://docs.seleniumhq.org/projects/webdriver/">Selenium</a>, it lets you programmatically simulate a user clicking around in a real web browser, performing a sequence of steps - perhaps creating an account or logging in.</p>

<p>The trouble is: on which instance of your site should you run these tests? If the test involves creating an account, for example, then you don’t want to clutter your production database with all those test accounts. You probably also don’t want to use your local development site - the one running in IIS or IIS Express on your own computer - partly to avoid clutter, and partly so that you can treat test data as disposable, in case you want to empty the database before a test run.</p>

<p>I imagine a common solution is to have a test instance of the site running on a server somewhere, perhaps in combination with a continuous integration server like <a href="http://www.jetbrains.com/teamcity/">TeamCity</a>. TeamCity could grab the latest code, deploy it to the test instance, empty the test database, and run the SpecFlow tests against the test instance.</p>

<p>Which is all well and good - and it is good - but what if you want to run this type of test on your own computer, before checking in? Testing is supposed to be all about a quick feedback loop, after all.</p>

<h3 id="introducing-dryrunner">Introducing DryRunner</h3>

<p>I couldn’t find an existing solution that I was happy with, so I wrote <a href="https://github.com/tgjones/dryrunner">DryRunner</a>. <strong>DryRunner allows you to do isolated integration testing for ASP.NET websites</strong> - and by isolated, I mean that the test website is separate, uses its own database, exists in a separate folder structure, and can be deleted when you’ve finished with it.</p>

<p>DryRunner itself is actually quite simple, because it’s built on a few existing <a href="http://www.youtube.com/watch?v=KVbsNgN4wJg">Lego blocks</a>: <a href="http://msdn.microsoft.com/en-us/library/dd410108(v=vs.110).aspx">ASP.NET deployment packages</a>, <a href="http://msdn.microsoft.com/en-us/library/dd465326(v=vs.110).aspx">web.config transforms</a>, and <a href="http://www.iis.net/learn/extensions/introduction-to-iis-express/iis-express-overview">IIS Express</a>.</p>

<p>So what does DryRunner actually do? It will:</p>

<ul>
  <li>deploy a test version of your website to a temporary location,</li>
  <li>host the test version of your website using IIS Express, and</li>
  <li>clean up afterwards by deleting the test version.</li>
</ul>

<p>DryRunner requires you to create a <code class="highlighter-rouge">Test</code> build configuration (alongside the usual <code class="highlighter-rouge">Debug</code>, <code class="highlighter-rouge">Release</code> and any other build configurations you may already have). You can use <code class="highlighter-rouge">Web.Test.config</code> to configure test-specific database connection strings, and other test-specific settings.</p>

<p>DryRunner is open source, and you’ll find the <a href="https://github.com/tgjones/dryrunner">source code on GitHub</a>. More usefully, there’s a <a href="https://www.nuget.org/packages/DryRunner/">DryRunner package on NuGet</a>.</p>

<h3 id="for-example">For example…</h3>

<p>I think a concrete example will help more than an abstract explanation would, so here goes. (For more concise usage instructions, see the <a href="https://github.com/tgjones/dryrunner">GitHub page</a>.)</p>

<p>First, we’ll create a new ASP.NET MVC 4 Web Application.</p>

<p><img src="/assets/posts/dryrunner-new-project.png" alt="" /></p>

<p>Choose the Internet Application template, and don’t create a unit test project. We’ll create one ourselves later.</p>

<p><img src="/assets/posts/dryrunner-choose-template.png" alt="" /></p>

<p>If we start the website now, we’ll see this in the browser. Later on, we’ll write an integration test that ensures the phrase “To learn more” is present on the page.</p>

<p><img src="/assets/posts/dryrunner-browser.png" alt="" /></p>

<p>Before using DryRunner, we need to create a Test configuration for the website you want to test. DryRunner will build the website using the Test configuration, including the relevant web.config transform, if you have one. Right-click on the solution name in Solution Explorer, and click “Configuration Manager…”. Find your web project, and in the Configuration column, choose “<New...>". In the Name textbox, enter "Test". Uncheck the box to create new solution configurations.</New...></p>

<p><img src="/assets/posts/dryrunner-solution-configuration.png" alt="" /></p>

<p>Now add a new Class Library project named [ProjectName].AcceptanceTests. Install the NUnit and DryRunner NuGet packages (skip NUnit if you prefer MSTest or another test framework):</p>

<p><img src="/assets/posts/dryrunner-nuget.png" alt="" /></p>

<p>Add a test class named HomePageTests.cs to the test project:</p>

<div class="language-csharp highlighter-rouge"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System.Net</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">DryRunner</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">NUnit.Framework</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">DryRunnerSample.AcceptanceTests</span>
<span class="p">{</span>
  <span class="p">[</span><span class="n">TestFixture</span><span class="p">]</span>
  <span class="k">public</span> <span class="k">class</span> <span class="nc">HomePageTests</span>
  <span class="p">{</span>
    <span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">Port</span> <span class="p">=</span> <span class="m">9000</span><span class="p">;</span>

    <span class="k">private</span> <span class="n">TestSiteManager</span> <span class="n">_testSiteManager</span><span class="p">;</span>

    <span class="p">[</span><span class="n">SetUp</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">SetUp</span><span class="p">()</span>
    <span class="p">{</span>
      <span class="k">const</span> <span class="kt">string</span> <span class="n">websiteProjectName</span> <span class="p">=</span> <span class="s">"DryRunnerSample"</span><span class="p">;</span>

      <span class="n">_testSiteManager</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TestSiteManager</span><span class="p">(</span><span class="n">websiteProjectName</span><span class="p">,</span> <span class="n">Port</span><span class="p">);</span>
      <span class="n">_testSiteManager</span><span class="p">.</span><span class="nf">Start</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="n">TearDown</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">TearDown</span><span class="p">()</span>
    <span class="p">{</span>
      <span class="n">_testSiteManager</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="n">Test</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">HomePageContainsCorrectContent</span><span class="p">()</span>
    <span class="p">{</span>
      <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">webClient</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">WebClient</span><span class="p">())</span>
      <span class="p">{</span>
        <span class="kt">string</span> <span class="n">html</span> <span class="p">=</span> <span class="n">webClient</span><span class="p">.</span><span class="nf">DownloadString</span><span class="p">(</span><span class="s">"http://localhost:"</span> <span class="p">+</span> <span class="n">Port</span><span class="p">);</span>
        <span class="n">Assert</span><span class="p">.</span><span class="nf">That</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">Contains</span><span class="p">.</span><span class="nf">Substring</span><span class="p">(</span><span class="s">"To learn more"</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>I’d normally use frameworks like <a href="http://www.specflow.org/">SpecFlow</a> and <a href="http://docs.seleniumhq.org/">Selenium</a> to avoid matching against the raw HTML, but I wanted to keep this example simple.</p>

<p>Run this test - it should pass. <strong>And that’s pretty much it</strong> - we’re now able to run integration tests against an isolated copy of an ASP.NET website.</p>

<p>So far, there’s not really any benefit over running integration tests in-place on your development website. But you will almost certainly want to manipulate a database as part of your tests. Here’s where DryRunner comes into its own: it let you use test-specific settings, such as a test-specific database connection string. This is best done using web.config transforms. In your web project, right-click on Web.config, and choose Add Config Transform. You’ll see a <code class="highlighter-rouge">Web.Test.config</code> file is added to the project. Refer to the <a href="http://msdn.microsoft.com/en-us/library/dd465326(v=vs.110).aspx">web.config transformation syntax</a> to see how you can insert new settings or replace settings inherited from the base <code class="highlighter-rouge">Web.config</code>.</p>

<p><img src="/assets/posts/dryrunner-solution-explorer.png" alt="" /></p>

<h3 id="give-it-a-try">Give it a try</h3>

<p>I hope someone out there finds this useful. I know of DryRunner being successfully used in some ASP.NET shops already, and if you use it I’d love to hear from you, particularly if you have any <a href="https://github.com/tgjones/dryrunner/issues">suggestions for improvement</a>.</p>

</article>

<nav class="pagination">
  
    <a class="pagination-item" href="/blog/archive/2014/01/10/new-sharpdx-module-for-gemini-direct3d-in-your-avalondock">Previous</a>
  
  
    <a class="pagination-item" href="/blog/archive/2014/04/13/writing-a-minic-to-msil-compiler-in-fsharp-part-0-introduction">Next</a>
  
</nav>

<div id="disqus_thread"></div>
<script>
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://timjones.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </main>
    </div>

    <footer class="site-footer">
        <div class="container">
            <div class="social">
    <ul>
        <li>
            <a href="https://twitter.com/_tim_jones_" rel="external">
                <svg width="30" height="30" viewBox="0 0 30 32" xmlns="http://www.w3.org/2000/svg" aria-labelledby="title">
  <title id="title">Twitter icon</title>
  <desc>A gray icon for following me on Twitter</desc>
  <path d="M28.928 7.296q-1.184 1.728-2.88 2.976 0 0.256 0 0.736 0 2.336-0.672 4.64t-2.048 4.448-3.296 3.744-4.608 2.624-5.792 0.96q-4.832 0-8.832-2.592 0.608 0.064 1.376 0.064 4.032 0 7.168-2.464-1.888-0.032-3.36-1.152t-2.048-2.848q0.608 0.096 1.088 0.096 0.768 0 1.536-0.192-2.016-0.416-3.328-1.984t-1.312-3.68v-0.064q1.216 0.672 2.624 0.736-1.184-0.8-1.888-2.048t-0.704-2.752q0-1.568 0.8-2.912 2.176 2.656 5.248 4.256t6.656 1.76q-0.16-0.672-0.16-1.312 0-2.4 1.696-4.064t4.064-1.696q2.528 0 4.224 1.824 1.952-0.384 3.68-1.408-0.672 2.048-2.56 3.2 1.664-0.192 3.328-0.896z"></path>
</svg>
                <span>Follow me on Twitter</span>
            </a>
        </li>
        <li>
            <a href="https://github.com/tgjones" rel="external">
                <svg width="30" height="30" viewBox="0 0 27 32" xmlns="http://www.w3.org/2000/svg" aria-labelledby="title">
  <title id="title">GitHub icon</title>
  <desc>A gray icon for following me on GitHub</desc>
  <path d="M13.728 2.272q3.712 0 6.88 1.856t4.992 4.992 1.824 6.88q0 4.48-2.624 8.064t-6.752 4.96q-0.48 0.096-0.704-0.128t-0.224-0.544q0-0.032 0-1.376t0-2.4q0-1.728-0.928-2.528 1.024-0.096 1.824-0.32t1.696-0.704 1.44-1.184 0.96-1.856 0.352-2.688q0-2.144-1.408-3.68 0.672-1.632-0.128-3.648-0.512-0.16-1.472 0.192t-1.632 0.8l-0.672 0.416q-1.664-0.48-3.424-0.48t-3.456 0.48q-0.256-0.192-0.736-0.48t-1.504-0.704-1.504-0.224q-0.8 2.016-0.16 3.648-1.408 1.536-1.408 3.68 0 1.504 0.384 2.656t0.928 1.888 1.44 1.184 1.664 0.704 1.824 0.32q-0.672 0.64-0.864 1.856-0.384 0.16-0.8 0.256t-1.024 0.096-1.152-0.384-0.992-1.12q-0.352-0.576-0.864-0.928t-0.896-0.448l-0.352-0.032q-0.384 0-0.512 0.064t-0.096 0.224 0.16 0.256 0.224 0.192l0.128 0.096q0.384 0.192 0.768 0.672t0.576 0.928l0.192 0.416q0.224 0.672 0.768 1.088t1.184 0.544 1.248 0.096 0.992-0.032l0.416-0.096q0 0.704 0 1.6t0.032 0.96q0 0.32-0.256 0.544t-0.704 0.128q-4.128-1.376-6.752-4.96t-2.624-8.064q0-3.744 1.856-6.88t4.96-4.992 6.912-1.856zM5.184 21.984q0.064-0.128-0.096-0.224-0.192-0.032-0.256 0.032-0.032 0.128 0.128 0.224t0.224-0.032zM5.76 22.592q0.128-0.096-0.032-0.288-0.192-0.16-0.288-0.064-0.128 0.096 0.032 0.288t0.288 0.064zM6.272 23.392q0.192-0.128 0-0.352-0.128-0.224-0.288-0.096-0.16 0.096 0 0.32t0.288 0.128zM7.040 24.128q0.128-0.128-0.064-0.32-0.224-0.224-0.352-0.064-0.16 0.16 0.064 0.352 0.192 0.192 0.352 0.032zM8.064 24.576q0.032-0.192-0.256-0.288-0.256-0.064-0.32 0.128t0.224 0.288q0.256 0.096 0.352-0.128zM9.184 24.672q0-0.224-0.32-0.192-0.288 0-0.288 0.192 0 0.224 0.32 0.192 0.288 0 0.288-0.192zM10.208 24.512q-0.032-0.224-0.32-0.16-0.288 0.032-0.256 0.256t0.32 0.128 0.256-0.224z"></path>
</svg>        
                <span>Follow me on GitHub</span>
            </a>
        </li>
        <li>
            <a href="https://www.strava.com/athletes/timjones" rel="external">
                <?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="30px" height="30px" viewBox="0 0 244 244" enable-background="new 0 0 244 244" xml:space="preserve">
<g>
	<path fill="none" d="M122,242C55.8,242,2,188.2,2,122S55.8,2,122,2c66.2,0,120,53.8,120,120S188.2,242,122,242z M122,21.7
		c-55.3,0-100.3,45-100.3,100.3s45,100.3,100.3,100.3s100.3-45,100.3-100.3S177.3,21.7,122,21.7z"/>
	<path d="M122,21.7c-55.3,0-100.3,45-100.3,100.3s45,100.3,100.3,100.3s100.3-45,100.3-100.3S177.3,21.7,122,21.7z"
		/>
	<g>
		<polyline fill="#fff" points="139.4,184.3 112.3,131.1 128.4,131.1 139.4,152.6 150.2,131.1 166.3,131.1 139.4,184.3 		"/>
		<polygon fill="#fff" points="113.9,102.2 128.6,131.2 150.1,131.2 113.7,59.7 77.7,131.2 99.3,131.2 113.9,102.2 		"/>
	</g>
</g>
</svg>

                <span>Follow me on Strava</span>
            </a>
        </li>
    </ul>
</div>

            <p>© 2017 Tim Jones. All rights reserved.</p>
        </div>
    </footer>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-5166698-5', 'auto');
  ga('send', 'pageview');
</script>
</body>

</html>