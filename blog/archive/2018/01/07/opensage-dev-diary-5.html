<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">

    <title>OpenSAGE Dev Diary #5 (2018-01-07) - timjones.io</title>

    <meta name="description" content="Blog and open source projects by Tim Jones.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="alternate" href="http://timjones.io/feed.xml" type="application/atom+xml" title="timjones.io Feed">

    <link href="https://fonts.googleapis.com/css?family=Noto+Sans|Noto+Serif|Source+Code+Pro" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/site.css">

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$','$'], ['\\(','\\)']],
                processEscapes: true
            },
            showProcessingMessages: false
        });
    </script>
    <script type="text/javascript" async src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML.js"></script>
</head>

<body>
    <header class="masthead">
        <div class="container">
            <nav>
                <ul>
                    <li>
                        <h3><a href="/" class="site-title">Tim Jones</a></h3>
                    </li>
                    <li><a href="/projects/">Projects</a></li>
                    <li><a href="/about/">About</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        <main>
            <article>
    <h1 class="post-title">OpenSAGE Dev Diary #5 (2018-01-07)</h1>

    <div class="post-date">
        <time datetime="2018-01-07T15:00:00+00:00">07 January 2018</time>
    </div>

    
    <div class="post-tags">
        <ul>
            
            <li><a href="/blog/tags/opensage">OpenSAGE</a></li>
            
        </ul>
    </div>
    

    <p><em>OpenSAGE is an open-source re-implementation of the <a href="https://en.wikipedia.org/wiki/SAGE_(game_engine)">SAGE game engine</a>. SAGE was the game engine used in C&amp;C Generals, C&amp;C Generals Zero Hour, Battle for Middle-earth and its sequels, C&amp;C 3 and its sequel, and Red Alert 3 and its sequel. I’ve been working on OpenSAGE for 6 months, and made some good progress, so I’ve started this series of blog posts to talk about what is happening in the project each week. You can also star or watch the <a href="https://github.com/OpenSAGE/OpenSAGE">OpenSAGE GitHub repo</a> for a more real-time view of things.</em></p>

<p>Following on from <a href="/blog/archive/2017/12/24/opensage-dev-diary-4-2017-12-24">the previous post</a>, here is what’s been happening this week in <a href="https://github.com/OpenSAGE/OpenSAGE">OpenSAGE</a>.</p>

<h2 id="progress-this-week">Progress this week</h2>

<p>The last two weeks have been exciting ones for the OpenSAGE project. For the first time, as much has been done by other contributors as by me, which marks an exciting turning point for the project.</p>

<p>This week’s contributors (other than me):</p>

<ul>
  <li><a href="https://github.com/feliwir">Stephan Vedder</a></li>
  <li><a href="https://github.com/paavohuhtala">Paavo Huhtala</a></li>
</ul>

<p>In the last two weeks:</p>

<ul>
  <li>
    <p>Paavo <a href="https://github.com/OpenSAGE/OpenSAGE/pull/13">fixed parsing of floating-point values in .ini files for locales with decimal separators other than “.”</a>, and <a href="https://github.com/OpenSAGE/OpenSAGE/pull/24">fixed a related issue</a>.</p>
  </li>
  <li>
    <p>Paavo <a href="https://github.com/OpenSAGE/OpenSAGE/pull/14">fixed .wnd controls that have a null header template</a>.</p>
  </li>
  <li>
    <p>I <a href="https://github.com/OpenSAGE/OpenSAGE/commit/61994bee78f963a40eb4fea2c86c8113ceef78ab">simplified the render pipeline</a>, because it was getting unnecessarily complex.</p>
  </li>
  <li>
    <p>Paavo <a href="https://github.com/OpenSAGE/OpenSAGE/pull/15">added support for the Origin version of Zero Hour’s registry key</a>.</p>
  </li>
  <li>
    <p>Paavo <a href="https://github.com/OpenSAGE/OpenSAGE/pull/16">created an Xunit test discoverer to allow skipping of tests that depend on games that aren’t currently installed</a>.</p>
  </li>
  <li>
    <p>I parsed BFME I and BFME II <code class="highlighter-rouge">.map</code> files. It turned out there were lots of new and modified chunks for these games: <code class="highlighter-rouge">CameraAnimationList</code>, <code class="highlighter-rouge">EnvironmentData</code>, <code class="highlighter-rouge">LibraryMapLists</code>, <code class="highlighter-rouge">MPPositionList</code>, <code class="highlighter-rouge">NamedCameras</code>, <code class="highlighter-rouge">PolygonTriggers</code>, <code class="highlighter-rouge">PostEffectsChunk</code>, <code class="highlighter-rouge">RiverAreas</code>, <code class="highlighter-rouge">SkyboxSettings</code>, <code class="highlighter-rouge">StandingWaterAreas</code>, <code class="highlighter-rouge">StandingWaveAreas</code>, and <code class="highlighter-rouge">Teams</code>. There aren’t any existing specifications for these chunks so I had to figure them out by hand. BFME scripts have a few new fields, like <code class="highlighter-rouge">Enabled</code> and <code class="highlighter-rouge">Inverted</code> and some related to sequential scripts. There’s a problem with terrain tile texture blending in BFME maps that I still need to fix, as you can see this in screenshot:</p>
  </li>
</ul>

<p><img src="/assets/resized/opensage-2018-01-08-bfmeii-map-1600x967.png" alt="BFME II map" srcset="/assets/resized/opensage-2018-01-08-bfmeii-map-400x242.png 400w,/assets/resized/opensage-2018-01-08-bfmeii-map-800x483.png 800w,/assets/resized/opensage-2018-01-08-bfmeii-map-1200x725.png 1200w,/assets/resized/opensage-2018-01-08-bfmeii-map-1600x967.png 1600w" /></p>

<ul>
  <li>
    <p>Stephan <a href="https://github.com/OpenSAGE/OpenSAGE/pull/20">fixed .dds and .tga previews in the Data Viewer</a>.</p>
  </li>
  <li>
    <p>Paavo <a href="https://github.com/OpenSAGE/OpenSAGE/pull/21">fixed a crash in the Data Viewer that occurred when switching between different assets</a>.</p>
  </li>
  <li>
    <p>Paavo <a href="https://github.com/OpenSAGE/OpenSAGE/pull/23">fixed a bug in the Z positioning of some map objects</a>.</p>
  </li>
  <li>
    <p>Paavo <a href="https://github.com/OpenSAGE/OpenSAGE/pull/29">fixed / implemented a number of things related to loading campaign maps</a>.</p>
  </li>
  <li>
    <p>Stephan <a href="https://github.com/OpenSAGE/OpenSAGE/pull/28">implemented a viewer for .ru files</a>. <code class="highlighter-rouge">.ru</code> files store the raw geometry for APT UI screens, and this was a major stepping stone to the APT implementation that Stephan is continuing to work on.</p>

    <p><img src="https://user-images.githubusercontent.com/2104576/34483227-520a9f2c-efbd-11e7-89d7-fd295c731d7a.png" alt="Screenshot of .ru viewer" /></p>
  </li>
  <li>
    <p>I parsed more BFME <code class="highlighter-rouge">.ini</code> files. These are obviously not required for Generals, but I find it helpful to get a detailed overview of  other SAGE games, so I can better design some of the engine abstractions.</p>
  </li>
  <li>
    <p>Stephan <a href="https://github.com/OpenSAGE/OpenSAGE/pull/38">updated the Xunit NuGet package</a> - a small but nice bit of maintenance that makes tests run more reliably.</p>
  </li>
  <li>
    <p>Paavo <a href="https://github.com/OpenSAGE/OpenSAGE/pull/35">added a project for the game executable</a>. This is the start of something that will eventually be <em>the</em> way to play games using OpenSAGE. For now, it launches the Generals main menu with the background scene (“shell map”) underneath.</p>

    <blockquote class="twitter-video" data-lang="en"><p lang="en" dir="ltr">Something pretty experimental... <a href="https://twitter.com/hashtag/OpenSAGE?src=hash&amp;ref_src=twsrc%5Etfw">#OpenSAGE</a> <a href="https://t.co/6IOaAWTbLY">pic.twitter.com/6IOaAWTbLY</a></p>&mdash; Paavo Huhtala (@paavohtl) <a href="https://twitter.com/paavohtl/status/948352514814038016?ref_src=twsrc%5Etfw">January 3, 2018</a></blockquote>
    <script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  </li>
  <li>
    <p>I started a refactoring of OpenSAGE’s scene framework. Up to now I have been using a simplified version of Unity’s <code class="highlighter-rouge">GameObject</code> / <code class="highlighter-rouge">Component</code> model, but this doesn’t really match how SAGE originally worked. So I’m changing things about a bit, in order to provide a simpler and more stable foundation going forwards.</p>
  </li>
</ul>

<p>In non-development news, we now have an <a href="https://discord.gg/G2FhZUT">OpenSAGE Discord server</a>. Follow that invitation link to join. We’re already having lots of lively discussions, so if you’re at all interested in SAGE games or the OpenSAGE project, please join us.</p>

<p>I also found a mention of OpenSAGE on a <a href="http://www.cncseries.ru/opensage/">Russian C&amp;C website</a>, which is pretty cool. Considering how little effort I’ve put into spreading the word, it’s nice to see that people are hearing about it.</p>

<p>That’s all for this time - until next week!</p>

</article>

<nav class="pagination">
  
    <a class="pagination-item" href="/blog/archive/2017/12/24/opensage-dev-diary-4-2017-12-24">Previous</a>
  
  
    <a class="pagination-item" href="/blog/archive/2018/02/10/opensage-dev-diary-6-and-first-release">Next</a>
  
</nav>

<div id="disqus_thread"></div>
<script>
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://timjones.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </main>
    </div>

    <footer class="site-footer">
        <div class="container">
            <div class="social">
    <ul>
        <li>
            <a href="https://twitter.com/_tim_jones_" rel="external">
                <svg width="30" height="30" viewBox="0 0 30 32" xmlns="http://www.w3.org/2000/svg" aria-labelledby="title">
  <title id="title">Twitter icon</title>
  <desc>A gray icon for following me on Twitter</desc>
  <path d="M28.928 7.296q-1.184 1.728-2.88 2.976 0 0.256 0 0.736 0 2.336-0.672 4.64t-2.048 4.448-3.296 3.744-4.608 2.624-5.792 0.96q-4.832 0-8.832-2.592 0.608 0.064 1.376 0.064 4.032 0 7.168-2.464-1.888-0.032-3.36-1.152t-2.048-2.848q0.608 0.096 1.088 0.096 0.768 0 1.536-0.192-2.016-0.416-3.328-1.984t-1.312-3.68v-0.064q1.216 0.672 2.624 0.736-1.184-0.8-1.888-2.048t-0.704-2.752q0-1.568 0.8-2.912 2.176 2.656 5.248 4.256t6.656 1.76q-0.16-0.672-0.16-1.312 0-2.4 1.696-4.064t4.064-1.696q2.528 0 4.224 1.824 1.952-0.384 3.68-1.408-0.672 2.048-2.56 3.2 1.664-0.192 3.328-0.896z"></path>
</svg>
                <span>Follow me on Twitter</span>
            </a>
        </li>
        <li>
            <a href="https://github.com/tgjones" rel="external">
                <svg width="30" height="30" viewBox="0 0 27 32" xmlns="http://www.w3.org/2000/svg" aria-labelledby="title">
  <title id="title">GitHub icon</title>
  <desc>A gray icon for following me on GitHub</desc>
  <path d="M13.728 2.272q3.712 0 6.88 1.856t4.992 4.992 1.824 6.88q0 4.48-2.624 8.064t-6.752 4.96q-0.48 0.096-0.704-0.128t-0.224-0.544q0-0.032 0-1.376t0-2.4q0-1.728-0.928-2.528 1.024-0.096 1.824-0.32t1.696-0.704 1.44-1.184 0.96-1.856 0.352-2.688q0-2.144-1.408-3.68 0.672-1.632-0.128-3.648-0.512-0.16-1.472 0.192t-1.632 0.8l-0.672 0.416q-1.664-0.48-3.424-0.48t-3.456 0.48q-0.256-0.192-0.736-0.48t-1.504-0.704-1.504-0.224q-0.8 2.016-0.16 3.648-1.408 1.536-1.408 3.68 0 1.504 0.384 2.656t0.928 1.888 1.44 1.184 1.664 0.704 1.824 0.32q-0.672 0.64-0.864 1.856-0.384 0.16-0.8 0.256t-1.024 0.096-1.152-0.384-0.992-1.12q-0.352-0.576-0.864-0.928t-0.896-0.448l-0.352-0.032q-0.384 0-0.512 0.064t-0.096 0.224 0.16 0.256 0.224 0.192l0.128 0.096q0.384 0.192 0.768 0.672t0.576 0.928l0.192 0.416q0.224 0.672 0.768 1.088t1.184 0.544 1.248 0.096 0.992-0.032l0.416-0.096q0 0.704 0 1.6t0.032 0.96q0 0.32-0.256 0.544t-0.704 0.128q-4.128-1.376-6.752-4.96t-2.624-8.064q0-3.744 1.856-6.88t4.96-4.992 6.912-1.856zM5.184 21.984q0.064-0.128-0.096-0.224-0.192-0.032-0.256 0.032-0.032 0.128 0.128 0.224t0.224-0.032zM5.76 22.592q0.128-0.096-0.032-0.288-0.192-0.16-0.288-0.064-0.128 0.096 0.032 0.288t0.288 0.064zM6.272 23.392q0.192-0.128 0-0.352-0.128-0.224-0.288-0.096-0.16 0.096 0 0.32t0.288 0.128zM7.040 24.128q0.128-0.128-0.064-0.32-0.224-0.224-0.352-0.064-0.16 0.16 0.064 0.352 0.192 0.192 0.352 0.032zM8.064 24.576q0.032-0.192-0.256-0.288-0.256-0.064-0.32 0.128t0.224 0.288q0.256 0.096 0.352-0.128zM9.184 24.672q0-0.224-0.32-0.192-0.288 0-0.288 0.192 0 0.224 0.32 0.192 0.288 0 0.288-0.192zM10.208 24.512q-0.032-0.224-0.32-0.16-0.288 0.032-0.256 0.256t0.32 0.128 0.256-0.224z"></path>
</svg>        
                <span>Follow me on GitHub</span>
            </a>
        </li>
        <li>
            <a href="https://www.strava.com/athletes/timjones" rel="external">
                <?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="30px" height="30px" viewBox="0 0 244 244" enable-background="new 0 0 244 244" xml:space="preserve">
<g>
	<path fill="none" d="M122,242C55.8,242,2,188.2,2,122S55.8,2,122,2c66.2,0,120,53.8,120,120S188.2,242,122,242z M122,21.7
		c-55.3,0-100.3,45-100.3,100.3s45,100.3,100.3,100.3s100.3-45,100.3-100.3S177.3,21.7,122,21.7z"/>
	<path d="M122,21.7c-55.3,0-100.3,45-100.3,100.3s45,100.3,100.3,100.3s100.3-45,100.3-100.3S177.3,21.7,122,21.7z"
		/>
	<g>
		<polyline fill="#fff" points="139.4,184.3 112.3,131.1 128.4,131.1 139.4,152.6 150.2,131.1 166.3,131.1 139.4,184.3 		"/>
		<polygon fill="#fff" points="113.9,102.2 128.6,131.2 150.1,131.2 113.7,59.7 77.7,131.2 99.3,131.2 113.9,102.2 		"/>
	</g>
</g>
</svg>

                <span>Follow me on Strava</span>
            </a>
        </li>
    </ul>
</div>

            <p>© 2017 Tim Jones. All rights reserved.</p>
        </div>
    </footer>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-5166698-5', 'auto');
  ga('send', 'pageview');
</script>
</body>

</html>