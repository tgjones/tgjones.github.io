<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">

    <title>Drawing an XNA Model bounding box - timjones.io</title>

    <meta name="description" content="Blog and open source projects by Tim Jones.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="alternate" href="http://timjones.io/feed.xml" type="application/atom+xml" title="timjones.io Feed">

    <link href="https://fonts.googleapis.com/css?family=Noto+Sans|Noto+Serif|Source+Code+Pro" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/site.css">

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$','$'], ['\\(','\\)']],
                processEscapes: true
            },
            showProcessingMessages: false
        });
    </script>
    <script type="text/javascript" async src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML.js"></script>
</head>

<body>
    <header class="masthead">
        <div class="container">
            <nav>
                <ul>
                    <li>
                        <h3><a href="/" class="site-title">Tim Jones</a></h3>
                    </li>
                    <li><a href="/projects/">Projects</a></li>
                    <li><a href="/about/">About</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        <main>
            <article>
    <h1 class="post-title">Drawing an XNA Model bounding box</h1>

    <div class="post-date">
        <time datetime="2010-12-10T08:46:00+00:00">10 December 2010</time>
    </div>

    

    <ul>
  <li><em>The source code for a working version is <a href="https://github.com/tgjones/xna-tutorials/tree/master/DrawBoundingBox">here</a>.</em></li>
</ul>

<p>If you’re making a level editor, or perhaps a <a href="/blog/archive/2010/12/09/xbuilder-v-released">model viewer</a>, it can sometimes be useful to see a visualisation of the 3D space a model sits within. It might also be handy if you use bounding boxes for physics, and you want to check that the bounding box is really where you think it is.</p>

<h2 id="creating-the-bounding-box">Creating the bounding box</h2>

<p>First (and hopefully not surprisingly), you’ll need the bounding box itself. XNA has a nice structure for this, helpfully named <code class="highlighter-rouge">BoundingBox</code>. If you already have access to one of these for your model, then you can skip to the next section. If you only have a <code class="highlighter-rouge">Model</code> object, and want to creating a bounding box, then you can use this code. Note that the <code class="highlighter-rouge">ModelMesh</code> class has a <code class="highlighter-rouge">BoundingSphere</code> property. XNA allows us to create a <code class="highlighter-rouge">BoundingBox</code> from a <code class="highlighter-rouge">BoundingSphere</code>, but that wouldn’t be a tight fit - it would be larger than necessary. So I prefer to go back to the original vertices and use them to create the bounding box. Step 1, then, is to extract the vertex positions from the <code class="highlighter-rouge">Model</code>:</p>

<div class="language-csharp highlighter-rouge"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">VertexElementExtractor</span>
<span class="p">{</span>
	<span class="k">public</span> <span class="k">static</span> <span class="n">Vector3</span><span class="p">[]</span> <span class="nf">GetVertexElement</span><span class="p">(</span><span class="n">ModelMeshPart</span> <span class="n">meshPart</span><span class="p">,</span> <span class="n">VertexElementUsage</span> <span class="n">usage</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">VertexDeclaration</span> <span class="n">vd</span> <span class="p">=</span> <span class="n">meshPart</span><span class="p">.</span><span class="n">VertexBuffer</span><span class="p">.</span><span class="n">VertexDeclaration</span><span class="p">;</span>
		<span class="n">VertexElement</span><span class="p">[]</span> <span class="n">elements</span> <span class="p">=</span> <span class="n">vd</span><span class="p">.</span><span class="nf">GetVertexElements</span><span class="p">();</span>

		<span class="n">Func</span><span class="p">&lt;</span><span class="n">VertexElement</span><span class="p">,</span> <span class="kt">bool</span><span class="p">&gt;</span> <span class="n">elementPredicate</span> <span class="p">=</span> <span class="n">ve</span> <span class="p">=&gt;</span> <span class="n">ve</span><span class="p">.</span><span class="n">VertexElementUsage</span> <span class="p">==</span> <span class="n">usage</span> <span class="p">&amp;&amp;</span> <span class="n">ve</span><span class="p">.</span><span class="n">VertexElementFormat</span> <span class="p">==</span> <span class="n">VertexElementFormat</span><span class="p">.</span><span class="n">Vector3</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(!</span><span class="n">elements</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="n">elementPredicate</span><span class="p">))</span>
			<span class="k">return</span> <span class="k">null</span><span class="p">;</span>

		<span class="n">VertexElement</span> <span class="n">element</span> <span class="p">=</span> <span class="n">elements</span><span class="p">.</span><span class="nf">First</span><span class="p">(</span><span class="n">elementPredicate</span><span class="p">);</span>

		<span class="n">Vector3</span><span class="p">[]</span> <span class="n">vertexData</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">[</span><span class="n">meshPart</span><span class="p">.</span><span class="n">NumVertices</span><span class="p">];</span>
		<span class="n">meshPart</span><span class="p">.</span><span class="n">VertexBuffer</span><span class="p">.</span><span class="nf">GetData</span><span class="p">((</span><span class="n">meshPart</span><span class="p">.</span><span class="n">VertexOffset</span> <span class="p">*</span> <span class="n">vd</span><span class="p">.</span><span class="n">VertexStride</span><span class="p">)</span> <span class="p">+</span> <span class="n">element</span><span class="p">.</span><span class="n">Offset</span><span class="p">,</span>
			<span class="n">vertexData</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">vertexData</span><span class="p">.</span><span class="n">Length</span><span class="p">,</span> <span class="n">vd</span><span class="p">.</span><span class="n">VertexStride</span><span class="p">);</span>

		<span class="k">return</span> <span class="n">vertexData</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>We can now write the code to create a bounding box for a <code class="highlighter-rouge">ModelMeshPart</code>:</p>

<div class="language-csharp highlighter-rouge"><pre class="highlight"><code><span class="k">private</span> <span class="k">static</span> <span class="n">BoundingBox</span><span class="p">?</span> <span class="nf">GetBoundingBox</span><span class="p">(</span><span class="n">ModelMeshPart</span> <span class="n">meshPart</span><span class="p">,</span> <span class="n">Matrix</span> <span class="n">transform</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">meshPart</span><span class="p">.</span><span class="n">VertexBuffer</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
		<span class="k">return</span> <span class="k">null</span><span class="p">;</span>

	<span class="n">Vector3</span><span class="p">[]</span> <span class="n">positions</span> <span class="p">=</span> <span class="n">VertexElementExtractor</span><span class="p">.</span><span class="nf">GetVertexElement</span><span class="p">(</span><span class="n">meshPart</span><span class="p">,</span> <span class="n">VertexElementUsage</span><span class="p">.</span><span class="n">Position</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">positions</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
		<span class="k">return</span> <span class="k">null</span><span class="p">;</span>

	<span class="n">Vector3</span><span class="p">[]</span> <span class="n">transformedPositions</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">[</span><span class="n">positions</span><span class="p">.</span><span class="n">Length</span><span class="p">];</span>
	<span class="n">Vector3</span><span class="p">.</span><span class="nf">Transform</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="k">ref</span> <span class="n">transform</span><span class="p">,</span> <span class="n">transformedPositions</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">BoundingBox</span><span class="p">.</span><span class="nf">CreateFromPoints</span><span class="p">(</span><span class="n">transformedPositions</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Now we can loop through each <code class="highlighter-rouge">ModelMesh</code> and <code class="highlighter-rouge">ModelMeshPart</code> within the <code class="highlighter-rouge">Model</code>, and create the merged bounding box for the whole model (making sure to transform the positions based on the bone transforms):</p>

<div class="language-csharp highlighter-rouge"><pre class="highlight"><code><span class="k">private</span> <span class="k">static</span> <span class="n">BoundingBox</span> <span class="nf">CreateBoundingBox</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">Matrix</span><span class="p">[]</span> <span class="n">boneTransforms</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Matrix</span><span class="p">[</span><span class="n">model</span><span class="p">.</span><span class="n">Bones</span><span class="p">.</span><span class="n">Count</span><span class="p">];</span>
	<span class="n">model</span><span class="p">.</span><span class="nf">CopyAbsoluteBoneTransformsTo</span><span class="p">(</span><span class="n">boneTransforms</span><span class="p">);</span>

	<span class="n">BoundingBox</span> <span class="n">result</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BoundingBox</span><span class="p">();</span>
	<span class="k">foreach</span> <span class="p">(</span><span class="n">ModelMesh</span> <span class="n">mesh</span> <span class="k">in</span> <span class="n">model</span><span class="p">.</span><span class="n">Meshes</span><span class="p">)</span>
		<span class="k">foreach</span> <span class="p">(</span><span class="n">ModelMeshPart</span> <span class="n">meshPart</span> <span class="k">in</span> <span class="n">mesh</span><span class="p">.</span><span class="n">MeshParts</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">BoundingBox</span><span class="p">?</span> <span class="n">meshPartBoundingBox</span> <span class="p">=</span> <span class="nf">GetBoundingBox</span><span class="p">(</span><span class="n">meshPart</span><span class="p">,</span> <span class="n">boneTransforms</span><span class="p">[</span><span class="n">mesh</span><span class="p">.</span><span class="n">ParentBone</span><span class="p">.</span><span class="n">Index</span><span class="p">]);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">meshPartBoundingBox</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
				<span class="n">result</span> <span class="p">=</span> <span class="n">BoundingBox</span><span class="p">.</span><span class="nf">CreateMerged</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">meshPartBoundingBox</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>In XBuilder, I actually create a bounding box for each <code class="highlighter-rouge">ModelMesh</code>, but the general principle is the same.</p>

<p>We now have a <code class="highlighter-rouge">BoundingBox</code> for our <code class="highlighter-rouge">Model</code>, so we can get ready to draw it.</p>

<h2 id="preparing-to-draw-the-bounding-box">Preparing to draw the bounding box</h2>

<p>You could draw an actual box, with solid lines. I prefer the approach taken by most 3D modelling packages of just drawing the corners. This is a bit more involved, and sorry for the long code snippet. If anybody knows a cleverer way of doing this, please let me know! First we need a class to hold the vertex and index buffers we’re going to create:</p>

<div class="language-csharp highlighter-rouge"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">BoundingBoxBuffers</span>
<span class="p">{</span>
	<span class="k">public</span> <span class="n">VertexBuffer</span> <span class="n">Vertices</span><span class="p">;</span>
	<span class="k">public</span> <span class="kt">int</span> <span class="n">VertexCount</span><span class="p">;</span>
	<span class="k">public</span> <span class="n">IndexBuffer</span> <span class="n">Indices</span><span class="p">;</span>
	<span class="k">public</span> <span class="kt">int</span> <span class="n">PrimitiveCount</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Now we can build this object:</p>

<div class="language-csharp highlighter-rouge"><pre class="highlight"><code><span class="k">private</span> <span class="n">BoundingBoxBuffers</span> <span class="nf">CreateBoundingBoxBuffers</span><span class="p">(</span><span class="n">BoundingBox</span> <span class="n">boundingBox</span><span class="p">,</span> <span class="n">GraphicsDevice</span> <span class="n">graphicsDevice</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">BoundingBoxBuffers</span> <span class="n">boundingBoxBuffers</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BoundingBoxBuffers</span><span class="p">();</span>

	<span class="n">boundingBoxBuffers</span><span class="p">.</span><span class="n">PrimitiveCount</span> <span class="p">=</span> <span class="m">24</span><span class="p">;</span>
	<span class="n">boundingBoxBuffers</span><span class="p">.</span><span class="n">VertexCount</span> <span class="p">=</span> <span class="m">48</span><span class="p">;</span>

	<span class="n">VertexBuffer</span> <span class="n">vertexBuffer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">VertexBuffer</span><span class="p">(</span><span class="n">graphicsDevice</span><span class="p">,</span>
		<span class="k">typeof</span><span class="p">(</span><span class="n">VertexPositionColor</span><span class="p">),</span> <span class="n">boundingBoxBuffers</span><span class="p">.</span><span class="n">VertexCount</span><span class="p">,</span>
		<span class="n">BufferUsage</span><span class="p">.</span><span class="n">WriteOnly</span><span class="p">);</span>
	<span class="n">List</span><span class="p">&lt;</span><span class="n">VertexPositionColor</span><span class="p">&gt;</span> <span class="n">vertices</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">VertexPositionColor</span><span class="p">&gt;();</span>

	<span class="k">const</span> <span class="kt">float</span> <span class="n">ratio</span> <span class="p">=</span> <span class="m">5.0f</span><span class="p">;</span>

	<span class="n">Vector3</span> <span class="n">xOffset</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">((</span><span class="n">boundingBox</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">X</span> <span class="p">-</span> <span class="n">boundingBox</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">X</span><span class="p">)</span> <span class="p">/</span> <span class="n">ratio</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
	<span class="n">Vector3</span> <span class="n">yOffset</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="p">(</span><span class="n">boundingBox</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">Y</span> <span class="p">-</span> <span class="n">boundingBox</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span> <span class="p">/</span> <span class="n">ratio</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
	<span class="n">Vector3</span> <span class="n">zOffset</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="p">(</span><span class="n">boundingBox</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">Z</span> <span class="p">-</span> <span class="n">boundingBox</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">Z</span><span class="p">)</span> <span class="p">/</span> <span class="n">ratio</span><span class="p">);</span>
	<span class="n">Vector3</span><span class="p">[]</span> <span class="n">corners</span> <span class="p">=</span> <span class="n">boundingBox</span><span class="p">.</span><span class="nf">GetCorners</span><span class="p">();</span>

	<span class="c1">// Corner 1.
</span>	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">+</span> <span class="n">xOffset</span><span class="p">);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">-</span> <span class="n">yOffset</span><span class="p">);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">-</span> <span class="n">zOffset</span><span class="p">);</span>

	<span class="c1">// Corner 2.
</span>	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">-</span> <span class="n">xOffset</span><span class="p">);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">-</span> <span class="n">yOffset</span><span class="p">);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">-</span> <span class="n">zOffset</span><span class="p">);</span>

	<span class="c1">// Corner 3.
</span>	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">2</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="p">-</span> <span class="n">xOffset</span><span class="p">);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">2</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="p">+</span> <span class="n">yOffset</span><span class="p">);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">2</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="p">-</span> <span class="n">zOffset</span><span class="p">);</span>

	<span class="c1">// Corner 4.
</span>	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">3</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">3</span><span class="p">]</span> <span class="p">+</span> <span class="n">xOffset</span><span class="p">);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">3</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">3</span><span class="p">]</span> <span class="p">+</span> <span class="n">yOffset</span><span class="p">);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">3</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">3</span><span class="p">]</span> <span class="p">-</span> <span class="n">zOffset</span><span class="p">);</span>

	<span class="c1">// Corner 5.
</span>	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">4</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">4</span><span class="p">]</span> <span class="p">+</span> <span class="n">xOffset</span><span class="p">);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">4</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">4</span><span class="p">]</span> <span class="p">-</span> <span class="n">yOffset</span><span class="p">);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">4</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">4</span><span class="p">]</span> <span class="p">+</span> <span class="n">zOffset</span><span class="p">);</span>

	<span class="c1">// Corner 6.
</span>	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">5</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">5</span><span class="p">]</span> <span class="p">-</span> <span class="n">xOffset</span><span class="p">);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">5</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">5</span><span class="p">]</span> <span class="p">-</span> <span class="n">yOffset</span><span class="p">);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">5</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">5</span><span class="p">]</span> <span class="p">+</span> <span class="n">zOffset</span><span class="p">);</span>

	<span class="c1">// Corner 7.
</span>	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">6</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">6</span><span class="p">]</span> <span class="p">-</span> <span class="n">xOffset</span><span class="p">);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">6</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">6</span><span class="p">]</span> <span class="p">+</span> <span class="n">yOffset</span><span class="p">);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">6</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">6</span><span class="p">]</span> <span class="p">+</span> <span class="n">zOffset</span><span class="p">);</span>

	<span class="c1">// Corner 8.
</span>	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">7</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">7</span><span class="p">]</span> <span class="p">+</span> <span class="n">xOffset</span><span class="p">);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">7</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">7</span><span class="p">]</span> <span class="p">+</span> <span class="n">yOffset</span><span class="p">);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">7</span><span class="p">]);</span>
	<span class="nf">AddVertex</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">corners</span><span class="p">[</span><span class="m">7</span><span class="p">]</span> <span class="p">+</span> <span class="n">zOffset</span><span class="p">);</span>

	<span class="n">vertexBuffer</span><span class="p">.</span><span class="nf">SetData</span><span class="p">(</span><span class="n">vertices</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">());</span>
	<span class="n">boundingBoxBuffers</span><span class="p">.</span><span class="n">Vertices</span> <span class="p">=</span> <span class="n">vertexBuffer</span><span class="p">;</span>

	<span class="n">IndexBuffer</span> <span class="n">indexBuffer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">IndexBuffer</span><span class="p">(</span><span class="n">graphicsDevice</span><span class="p">,</span> <span class="n">IndexElementSize</span><span class="p">.</span><span class="n">SixteenBits</span><span class="p">,</span> <span class="n">boundingBoxBuffers</span><span class="p">.</span><span class="n">VertexCount</span><span class="p">,</span>
		<span class="n">BufferUsage</span><span class="p">.</span><span class="n">WriteOnly</span><span class="p">);</span>
	<span class="n">indexBuffer</span><span class="p">.</span><span class="nf">SetData</span><span class="p">(</span><span class="n">Enumerable</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">boundingBoxBuffers</span><span class="p">.</span><span class="n">VertexCount</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="n">i</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="kt">short</span><span class="p">)</span><span class="n">i</span><span class="p">).</span><span class="nf">ToArray</span><span class="p">());</span>
	<span class="n">boundingBoxBuffers</span><span class="p">.</span><span class="n">Indices</span> <span class="p">=</span> <span class="n">indexBuffer</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">boundingBoxBuffers</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">AddVertex</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">VertexPositionColor</span><span class="p">&gt;</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">Vector3</span> <span class="n">position</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vertices</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">VertexPositionColor</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">White</span><span class="p">));</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="drawing-the-bounding-box">Drawing the bounding box</h2>

<p>By now you should have an instance of <code class="highlighter-rouge">BoundingBoxBuffers</code>. To get it on to the screen, you’ll need an <code class="highlighter-rouge">Effect</code> - I keep it simple and use <code class="highlighter-rouge">BasicEffect</code>:</p>

<div class="language-csharp highlighter-rouge"><pre class="highlight"><code><span class="n">BasicEffect</span> <span class="n">lineEffect</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BasicEffect</span><span class="p">(</span><span class="n">graphicsDevice</span><span class="p">);</span>
<span class="n">lineEffect</span><span class="p">.</span><span class="n">LightingEnabled</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
<span class="n">lineEffect</span><span class="p">.</span><span class="n">TextureEnabled</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
<span class="n">lineEffect</span><span class="p">.</span><span class="n">VertexColorEnabled</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</code></pre>
</div>

<p>Finally, we’re ready to draw the bounding box:</p>

<div class="language-csharp highlighter-rouge"><pre class="highlight"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">DrawBoundingBox</span><span class="p">(</span><span class="n">BoundingBoxBuffers</span> <span class="n">buffers</span><span class="p">,</span> <span class="n">BasicEffect</span> <span class="n">effect</span><span class="p">,</span> <span class="n">GraphicsDevice</span> <span class="n">graphicsDevice</span><span class="p">,</span> <span class="n">Matrix</span> <span class="n">view</span><span class="p">,</span> <span class="n">Matrix</span> <span class="n">projection</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">graphicsDevice</span><span class="p">.</span><span class="nf">SetVertexBuffer</span><span class="p">(</span><span class="n">buffers</span><span class="p">.</span><span class="n">Vertices</span><span class="p">);</span>
	<span class="n">graphicsDevice</span><span class="p">.</span><span class="n">Indices</span> <span class="p">=</span> <span class="n">buffers</span><span class="p">.</span><span class="n">Indices</span><span class="p">;</span>

	<span class="n">effect</span><span class="p">.</span><span class="n">World</span> <span class="p">=</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">Identity</span><span class="p">;</span>
	<span class="n">effect</span><span class="p">.</span><span class="n">View</span> <span class="p">=</span> <span class="n">view</span><span class="p">;</span>
	<span class="n">effect</span><span class="p">.</span><span class="n">Projection</span> <span class="p">=</span> <span class="n">projection</span><span class="p">;</span>

	<span class="k">foreach</span> <span class="p">(</span><span class="n">EffectPass</span> <span class="n">pass</span> <span class="k">in</span> <span class="n">effect</span><span class="p">.</span><span class="n">CurrentTechnique</span><span class="p">.</span><span class="n">Passes</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">pass</span><span class="p">.</span><span class="nf">Apply</span><span class="p">();</span>
		<span class="n">graphicsDevice</span><span class="p">.</span><span class="nf">DrawIndexedPrimitives</span><span class="p">(</span><span class="n">PrimitiveType</span><span class="p">.</span><span class="n">LineList</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span>
			<span class="n">buffers</span><span class="p">.</span><span class="n">VertexCount</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">buffers</span><span class="p">.</span><span class="n">PrimitiveCount</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>If everything went right, you should have something that looks like this on your screen:</p>

<p><img src="/assets/posts/boundingbox.jpg" alt="bounding box image" /></p>

<p>If you don’t have that, or if I didn’t explain it properly, maybe looking at <a href="https://github.com/tgjones/xna-tutorials/tree/master/DrawBoundingBox">my version</a> will help. I hope this is useful - let me know if you have any comments or questions.</p>

</article>

<nav class="pagination">
  
    <a class="pagination-item" href="/blog/archive/2010/12/09/xbuilder-v-released">Previous</a>
  
  
    <a class="pagination-item" href="/blog/archive/2010/12/30/stitchup-in-action">Next</a>
  
</nav>

<div id="disqus_thread"></div>
<script>
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://timjones.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </main>
    </div>

    <footer class="site-footer">
        <div class="container">
            <div class="social">
    <ul>
        <li>
            <a href="https://twitter.com/_tim_jones_" rel="external">
                <svg width="30" height="30" viewBox="0 0 30 32" xmlns="http://www.w3.org/2000/svg" aria-labelledby="title">
  <title id="title">Twitter icon</title>
  <desc>A gray icon for following me on Twitter</desc>
  <path d="M28.928 7.296q-1.184 1.728-2.88 2.976 0 0.256 0 0.736 0 2.336-0.672 4.64t-2.048 4.448-3.296 3.744-4.608 2.624-5.792 0.96q-4.832 0-8.832-2.592 0.608 0.064 1.376 0.064 4.032 0 7.168-2.464-1.888-0.032-3.36-1.152t-2.048-2.848q0.608 0.096 1.088 0.096 0.768 0 1.536-0.192-2.016-0.416-3.328-1.984t-1.312-3.68v-0.064q1.216 0.672 2.624 0.736-1.184-0.8-1.888-2.048t-0.704-2.752q0-1.568 0.8-2.912 2.176 2.656 5.248 4.256t6.656 1.76q-0.16-0.672-0.16-1.312 0-2.4 1.696-4.064t4.064-1.696q2.528 0 4.224 1.824 1.952-0.384 3.68-1.408-0.672 2.048-2.56 3.2 1.664-0.192 3.328-0.896z"></path>
</svg>
                <span>Follow me on Twitter</span>
            </a>
        </li>
        <li>
            <a href="https://github.com/tgjones" rel="external">
                <svg width="30" height="30" viewBox="0 0 27 32" xmlns="http://www.w3.org/2000/svg" aria-labelledby="title">
  <title id="title">GitHub icon</title>
  <desc>A gray icon for following me on GitHub</desc>
  <path d="M13.728 2.272q3.712 0 6.88 1.856t4.992 4.992 1.824 6.88q0 4.48-2.624 8.064t-6.752 4.96q-0.48 0.096-0.704-0.128t-0.224-0.544q0-0.032 0-1.376t0-2.4q0-1.728-0.928-2.528 1.024-0.096 1.824-0.32t1.696-0.704 1.44-1.184 0.96-1.856 0.352-2.688q0-2.144-1.408-3.68 0.672-1.632-0.128-3.648-0.512-0.16-1.472 0.192t-1.632 0.8l-0.672 0.416q-1.664-0.48-3.424-0.48t-3.456 0.48q-0.256-0.192-0.736-0.48t-1.504-0.704-1.504-0.224q-0.8 2.016-0.16 3.648-1.408 1.536-1.408 3.68 0 1.504 0.384 2.656t0.928 1.888 1.44 1.184 1.664 0.704 1.824 0.32q-0.672 0.64-0.864 1.856-0.384 0.16-0.8 0.256t-1.024 0.096-1.152-0.384-0.992-1.12q-0.352-0.576-0.864-0.928t-0.896-0.448l-0.352-0.032q-0.384 0-0.512 0.064t-0.096 0.224 0.16 0.256 0.224 0.192l0.128 0.096q0.384 0.192 0.768 0.672t0.576 0.928l0.192 0.416q0.224 0.672 0.768 1.088t1.184 0.544 1.248 0.096 0.992-0.032l0.416-0.096q0 0.704 0 1.6t0.032 0.96q0 0.32-0.256 0.544t-0.704 0.128q-4.128-1.376-6.752-4.96t-2.624-8.064q0-3.744 1.856-6.88t4.96-4.992 6.912-1.856zM5.184 21.984q0.064-0.128-0.096-0.224-0.192-0.032-0.256 0.032-0.032 0.128 0.128 0.224t0.224-0.032zM5.76 22.592q0.128-0.096-0.032-0.288-0.192-0.16-0.288-0.064-0.128 0.096 0.032 0.288t0.288 0.064zM6.272 23.392q0.192-0.128 0-0.352-0.128-0.224-0.288-0.096-0.16 0.096 0 0.32t0.288 0.128zM7.040 24.128q0.128-0.128-0.064-0.32-0.224-0.224-0.352-0.064-0.16 0.16 0.064 0.352 0.192 0.192 0.352 0.032zM8.064 24.576q0.032-0.192-0.256-0.288-0.256-0.064-0.32 0.128t0.224 0.288q0.256 0.096 0.352-0.128zM9.184 24.672q0-0.224-0.32-0.192-0.288 0-0.288 0.192 0 0.224 0.32 0.192 0.288 0 0.288-0.192zM10.208 24.512q-0.032-0.224-0.32-0.16-0.288 0.032-0.256 0.256t0.32 0.128 0.256-0.224z"></path>
</svg>        
                <span>Follow me on GitHub</span>
            </a>
        </li>
        <li>
            <a href="https://www.strava.com/athletes/timjones" rel="external">
                <?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="30px" height="30px" viewBox="0 0 244 244" enable-background="new 0 0 244 244" xml:space="preserve">
<g>
	<path fill="none" d="M122,242C55.8,242,2,188.2,2,122S55.8,2,122,2c66.2,0,120,53.8,120,120S188.2,242,122,242z M122,21.7
		c-55.3,0-100.3,45-100.3,100.3s45,100.3,100.3,100.3s100.3-45,100.3-100.3S177.3,21.7,122,21.7z"/>
	<path d="M122,21.7c-55.3,0-100.3,45-100.3,100.3s45,100.3,100.3,100.3s100.3-45,100.3-100.3S177.3,21.7,122,21.7z"
		/>
	<g>
		<polyline fill="#fff" points="139.4,184.3 112.3,131.1 128.4,131.1 139.4,152.6 150.2,131.1 166.3,131.1 139.4,184.3 		"/>
		<polygon fill="#fff" points="113.9,102.2 128.6,131.2 150.1,131.2 113.7,59.7 77.7,131.2 99.3,131.2 113.9,102.2 		"/>
	</g>
</g>
</svg>

                <span>Follow me on Strava</span>
            </a>
        </li>
    </ul>
</div>

            <p>© 2017 Tim Jones. All rights reserved.</p>
        </div>
    </footer>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-5166698-5', 'auto');
  ga('send', 'pageview');
</script>
</body>

</html>